# æœåŠ¡å™¨åˆ›å»ºæ“ä½œæ—¥å¿—è¡¨

## ğŸš€ æ–¹æ³• 1ï¼šä½¿ç”¨è„šæœ¬åˆ›å»ºï¼ˆæ¨èï¼‰

```bash
cd /var/www/activities_management/backend
node scripts/create_activity_logs_table.js
```

## ğŸ”§ æ–¹æ³• 2ï¼šç›´æ¥æ‰§è¡Œ SQL

```bash
cd /var/www/activities_management/backend
mysql -u campus_user -p'Whut2025@' campus_activities < database/create_activity_logs.sql
```

## âš¡ æ–¹æ³• 3ï¼šæ‰‹åŠ¨æ‰§è¡Œ SQLï¼ˆå¦‚æœä¸Šé¢æ–¹æ³•ä¸è¡Œï¼‰

```bash
mysql -u campus_user -p'Whut2025@' campus_activities << 'EOF'
CREATE TABLE IF NOT EXISTS `activity_logs` (
  `log_id` int NOT NULL AUTO_INCREMENT,
  `user_id` int NULL DEFAULT NULL COMMENT 'è§¦å‘æ“ä½œçš„ç”¨æˆ·IDï¼Œå¯ä¸ºç©º',
  `username` varchar(100) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT 'è§¦å‘è€…ç”¨æˆ·å',
  `action` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'åŠ¨ä½œæè¿°ï¼Œå¦‚ GET /api/events',
  `method` varchar(10) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'HTTP æ–¹æ³•',
  `route` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NOT NULL COMMENT 'è·¯ç”±è·¯å¾„ï¼ˆä¸å«æŸ¥è¯¢å‚æ•°ï¼‰',
  `status_code` int NOT NULL COMMENT 'å“åº”çŠ¶æ€ç ',
  `success` tinyint NOT NULL DEFAULT 1 COMMENT 'æ˜¯å¦æˆåŠŸ (1-æˆåŠŸ 0-å¤±è´¥)',
  `duration_ms` int NULL DEFAULT NULL COMMENT 'è¯·æ±‚è€—æ—¶ (ms)',
  `ip_address` varchar(64) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT 'å®¢æˆ·ç«¯ IP',
  `user_agent` varchar(255) CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL DEFAULT NULL COMMENT 'å®¢æˆ·ç«¯ UA',
  `request_payload` text CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci NULL COMMENT 'è¯·æ±‚è´Ÿè½½ï¼ˆè¿‡æ»¤æ•æ„Ÿå­—æ®µï¼‰',
  `created_at` datetime NULL DEFAULT CURRENT_TIMESTAMP COMMENT 'åˆ›å»ºæ—¶é—´',
  PRIMARY KEY (`log_id`) USING BTREE,
  INDEX `idx_log_user`(`user_id` ASC) USING BTREE,
  INDEX `idx_log_route`(`route` ASC) USING BTREE,
  INDEX `idx_log_method`(`method` ASC) USING BTREE,
  INDEX `idx_log_status`(`status_code` ASC) USING BTREE,
  INDEX `idx_log_created_at`(`created_at` ASC) USING BTREE,
  CONSTRAINT `activity_logs_ibfk_1` FOREIGN KEY (`user_id`) REFERENCES `users` (`user_id`) ON DELETE SET NULL ON UPDATE RESTRICT
) ENGINE = InnoDB AUTO_INCREMENT = 1 CHARACTER SET = utf8mb4 COLLATE = utf8mb4_unicode_ci ROW_FORMAT = DYNAMIC;
EOF
```

## âœ… éªŒè¯è¡¨æ˜¯å¦åˆ›å»ºæˆåŠŸ

```bash
mysql -u campus_user -p'Whut2025@' campus_activities -e "SHOW TABLES LIKE 'activity_logs';"
```

## ğŸ”„ åˆ›å»ºåé‡å¯æœåŠ¡

```bash
pm2 restart all --update-env
```

