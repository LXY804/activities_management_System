# æœåŠ¡å™¨ä¿®å¤ç”¨æˆ·ç®¡ç†å’Œåˆ é™¤åŠŸèƒ½

## ğŸ”§ é—®é¢˜1ï¼šæ˜¾ç¤º"æœªçŸ¥ç”¨æˆ·"
åŸå› ï¼šåç«¯æ•°æ®æ˜ å°„é”™è¯¯ï¼Œä½¿ç”¨äº† `user.userId` è€Œä¸æ˜¯ `user.id`

## ğŸ”§ é—®é¢˜2ï¼šæ— æ³•åˆ é™¤ç”¨æˆ·
åŸå› ï¼šå‰ç«¯ç¼ºå°‘ `onDeleteUser` å‡½æ•°

## ğŸš€ ä¿®å¤æ–¹æ³•1ï¼šä» Git æ‹‰å–æœ€æ–°ä»£ç ï¼ˆæ¨èï¼‰

```bash
cd /var/www/activities_management
git fetch origin
git reset --hard origin/main
cd backend
pm2 restart all --update-env
cd ../æ ¡å›­æ´»åŠ¨ç®¡ç†ç³»ç»Ÿ
npm run build
```

## ğŸ”§ ä¿®å¤æ–¹æ³•2ï¼šç›´æ¥åœ¨æœåŠ¡å™¨ä¸Šä¿®å¤

### ä¿®å¤åç«¯æ•°æ®æ˜ å°„
```bash
cd /var/www/activities_management/backend/controllers
# å¤‡ä»½
cp userController.js userController.js.bak

# ä¿®å¤æ•°æ®æ˜ å°„
sed -i "s/id: user\.userId,/id: user.id || user.get('id'),/g" userController.js
sed -i "s/name: user\.username,/name: user.name || user.get('name') || user.username || 'æœªçŸ¥ç”¨æˆ·',/g" userController.js
sed -i "s/role: roleMap\[user\.role\] || user\.role,/role: roleMap[user.role] || user.role || 'æœªçŸ¥è§’è‰²',/g" userController.js

# éªŒè¯ä¿®å¤
grep -A 8 "const list = rows.map" userController.js | head -10

# é‡å¯åç«¯
pm2 restart all --update-env
```

### ä¿®å¤å‰ç«¯åˆ é™¤å‡½æ•°
```bash
cd /var/www/activities_management/æ ¡å›­æ´»åŠ¨ç®¡ç†ç³»ç»Ÿ/src/views
# åœ¨ loadUserStats å‡½æ•°åæ·»åŠ  onDeleteUser å‡½æ•°
# ä½¿ç”¨ nano æˆ– vi ç¼–è¾‘æ–‡ä»¶
nano AdminDashboard.vue
```

æ‰¾åˆ° `loadUserStats` å‡½æ•°çš„ç»“æŸä½ç½®ï¼ˆå¤§çº¦ç¬¬ 1693 è¡Œï¼‰ï¼Œåœ¨ `// åŠ è½½æœ¬æœˆæ–°å¢ç”¨æˆ·` ä¹‹å‰æ·»åŠ ï¼š

```javascript
// åˆ é™¤ç”¨æˆ·
const onDeleteUser = async (user) => {
  if (!user || !user.id) {
    showNotification('ç”¨æˆ·ä¿¡æ¯ä¸å®Œæ•´ï¼Œæ— æ³•åˆ é™¤', 'warning')
    return
  }
  
  if (!confirm(`ç¡®å®šè¦åˆ é™¤ç”¨æˆ· "${user.name || 'æœªçŸ¥ç”¨æˆ·'}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
    return
  }
  
  deletingUserId.value = user.id
  try {
    await fetchDeleteUser(user.id)
    showNotification('âœ“ ç”¨æˆ·å·²åˆ é™¤', 'success')
    // é‡æ–°åŠ è½½ç”¨æˆ·åˆ—è¡¨
    await loadUsers()
    await loadUserStats()
  } catch (e) {
    console.error('åˆ é™¤ç”¨æˆ·å¤±è´¥:', e)
    const errorMsg = e.response?.data?.message || e.message || 'æœªçŸ¥é”™è¯¯'
    showNotification(`åˆ é™¤ç”¨æˆ·å¤±è´¥: ${errorMsg}`, 'warning')
  } finally {
    deletingUserId.value = null
  }
}
```

ä¿å­˜åé‡æ–°æ„å»ºï¼š
```bash
cd /var/www/activities_management/æ ¡å›­æ´»åŠ¨ç®¡ç†ç³»ç»Ÿ
npm run build
```

