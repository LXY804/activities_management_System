# éªŒè¯å›¾ç‰‡ä¼˜åŒ–æ•ˆæœ

## âœ… å·²å®Œæˆæ­¥éª¤

1. âœ… Nginx é…ç½®å·²æ›´æ–°
2. âœ… Nginx é…ç½®æµ‹è¯•é€šè¿‡
3. âœ… Nginx å·²é‡è½½
4. âœ… æ–‡ä»¶æƒé™å·²è®¾ç½®

---

## ğŸ“‹ ä¸‹ä¸€æ­¥ï¼šé‡æ–°æ„å»ºå‰ç«¯

å‰ç«¯ä»£ç å·²æ›´æ–°ï¼ˆä½¿ç”¨äº† OptimizedImage ç»„ä»¶ï¼‰ï¼Œéœ€è¦é‡æ–°æ„å»ºï¼š

```bash
cd /var/www/activities_management/æ ¡å›­æ´»åŠ¨ç®¡ç†ç³»ç»Ÿ
npm run build
```

---

## ğŸ§ª éªŒè¯ä¼˜åŒ–æ•ˆæœ

### æ–¹æ³• 1ï¼šæµè§ˆå™¨å¼€å‘è€…å·¥å…·ï¼ˆæ¨èï¼‰

1. **æ‰“å¼€ç½‘ç«™**
   - è®¿é—®ä½ çš„ç½‘ç«™
   - æŒ‰ `F12` æ‰“å¼€å¼€å‘è€…å·¥å…·
   - åˆ‡æ¢åˆ° **Network** æ ‡ç­¾

2. **åˆ·æ–°é¡µé¢**
   - æŒ‰ `Ctrl+Shift+R` å¼ºåˆ¶åˆ·æ–°ï¼ˆæ¸…é™¤ç¼“å­˜ï¼‰
   - è§‚å¯Ÿå›¾ç‰‡è¯·æ±‚

3. **æ£€æŸ¥å›¾ç‰‡è¯·æ±‚**
   - ç‚¹å‡»ä»»æ„å›¾ç‰‡è¯·æ±‚ï¼ˆå¦‚ `xxx.jpg`ï¼‰
   - æŸ¥çœ‹ **Headers** æ ‡ç­¾ï¼š

   **åº”è¯¥çœ‹åˆ°ï¼š**
   - âœ… **Status Code**: `200 OK`
   - âœ… **Response Headers**:
     - `Cache-Control: public, max-age=2592000`
     - `Expires: ...` (30å¤©åçš„æ—¥æœŸ)
     - `X-Content-Type-Options: nosniff`
   - âœ… **Request URL**: åº”è¯¥æ˜¯ `http://ä½ çš„åŸŸå/uploads/xxx.jpg`ï¼ˆä¸åŒ…å« `/api`ï¼‰

   **ä¸åº”è¯¥çœ‹åˆ°ï¼š**
   - âŒ è¯·æ±‚ç»è¿‡ `/api` è·¯å¾„
   - âŒ `Cache-Control: no-cache`

4. **æ€§èƒ½å¯¹æ¯”**
   - æŸ¥çœ‹å›¾ç‰‡çš„ **Time** åˆ—
   - ä¼˜åŒ–å‰ï¼šé€šå¸¸ 200-500ms
   - ä¼˜åŒ–åï¼šé€šå¸¸ 50-150ms
   - **æå‡ï¼š60-70%**

---

### æ–¹æ³• 2ï¼šå‘½ä»¤è¡Œæµ‹è¯•

```bash
# æµ‹è¯•å›¾ç‰‡è¯·æ±‚ï¼ˆåº”è¯¥ç›´æ¥ä» Nginx è¿”å›ï¼Œä¸ç»è¿‡åç«¯ï¼‰
curl -I http://localhost/uploads/æŸä¸ªå›¾ç‰‡æ–‡ä»¶å.jpg

# åº”è¯¥çœ‹åˆ°ï¼š
# HTTP/1.1 200 OK
# Cache-Control: public, max-age=2592000
# Expires: ...
```

---

### æ–¹æ³• 3ï¼šæ£€æŸ¥åç«¯æ—¥å¿—

```bash
# æŸ¥çœ‹åç«¯æ—¥å¿—ï¼Œå›¾ç‰‡è¯·æ±‚åº”è¯¥ä¸å†å‡ºç°åœ¨æ—¥å¿—ä¸­
pm2 logs activities-backend --lines 50 | grep -i uploads

# å¦‚æœä¼˜åŒ–æˆåŠŸï¼Œåº”è¯¥å¾ˆå°‘æˆ–æ²¡æœ‰å›¾ç‰‡è¯·æ±‚çš„æ—¥å¿—
```

---

## ğŸ“Š é¢„æœŸæ•ˆæœ

| æŒ‡æ ‡ | ä¼˜åŒ–å‰ | ä¼˜åŒ–å | æå‡ |
|------|--------|--------|------|
| å•å›¾åŠ è½½æ—¶é—´ | 200-500ms | 50-150ms | **60-70%** |
| åç«¯ CPU ä½¿ç”¨ | è¾ƒé«˜ | é™ä½ | **30-50%** |
| å¹¶å‘å¤„ç†èƒ½åŠ› | å—é™ | æå‡ | **2-3å€** |
| å¸¦å®½ä½¿ç”¨ | æ­£å¸¸ | å‡å°‘ï¼ˆç¼“å­˜ï¼‰ | **30-50%** |

---

## ğŸ” æ£€æŸ¥æ¸…å•

- [ ] å‰ç«¯å·²é‡æ–°æ„å»º
- [ ] æµè§ˆå™¨æµ‹è¯•é€šè¿‡
- [ ] å›¾ç‰‡è¯·æ±‚ç›´æ¥ä» Nginx è¿”å›
- [ ] å“åº”å¤´åŒ…å«ç¼“å­˜ä¿¡æ¯
- [ ] å›¾ç‰‡åŠ è½½é€Ÿåº¦æ˜æ˜¾æå‡
- [ ] åç«¯æ—¥å¿—ä¸­å›¾ç‰‡è¯·æ±‚å‡å°‘

---

## âš ï¸ å¦‚æœå›¾ç‰‡æ˜¾ç¤º 404

**å¯èƒ½åŸå› ï¼š**
1. æ–‡ä»¶è·¯å¾„ä¸æ­£ç¡®
2. æ–‡ä»¶æƒé™é—®é¢˜
3. Nginx root è·¯å¾„é…ç½®é”™è¯¯

**è§£å†³æ–¹æ³•ï¼š**
```bash
# 1. æ£€æŸ¥æ–‡ä»¶æ˜¯å¦å­˜åœ¨
ls -la /var/www/activities_management/backend/uploads/

# 2. æ£€æŸ¥ Nginx é…ç½®ä¸­çš„ root è·¯å¾„
sudo grep "root.*backend" /etc/nginx/sites-available/activities_management

# 3. æ£€æŸ¥æ–‡ä»¶æƒé™
sudo chown -R www-data:www-data /var/www/activities_management/backend/uploads
sudo chmod -R 755 /var/www/activities_management/backend/uploads

# 4. æŸ¥çœ‹ Nginx é”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/activities_error.log
```

---

## ğŸ‰ ä¼˜åŒ–å®Œæˆï¼

å¦‚æœæ‰€æœ‰æ£€æŸ¥éƒ½é€šè¿‡ï¼Œæ­å–œä½ ï¼å›¾ç‰‡åŠ è½½é€Ÿåº¦å·²å¤§å¹…æå‡ï¼

